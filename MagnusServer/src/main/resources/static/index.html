<html>
<head>
    <title>Magnus</title>
    <script src="jquery.js"></script>
    <script>
        var streamersData;
        var streamPlayer;
        var onlineTable;
        var offlineTable;

        $(document).ready(onReady);

        function onReady() {
            streamPlayer = document.getElementById("streamPlayer");
            onlineTable = document.getElementById("onlineTable");
            offlineTable = document.getElementById("offlineTable");

            $.ajax({
				type: 'GET',
				dataType: 'json',
				url: '/get_streamers_list',
				success: function(data) {
                    console.log(data);
					onObtainedStreamersInfo(data);
				}
			});

            setInterval(function() {
                streamPlayer.src = "/screenshot?login=" + streamersData.onlineStreamers[0].login + "&nocache=" + Math.floor(Math.random() * 1000000);
            }, 200);
        }

        function onObtainedStreamersInfo(data) {
            streamersData = data;

            $(onlineTable).children().remove();
            let i = 0;
            for(const streamer of data.onlineStreamers) {
                addRow(onlineTable, i, streamer);
                i++
            }

            $(offlineTable).children().remove();
            i = 0;
            for(const streamer of data.offlineStreamers) {
                addRow(offlineTable, i, streamer.streamerInfo, "(Last seen: " + streamer.lastSeen + ")");
                i++;
            }
        }

        function addRow(table, i, streamer, additionalInfo) {
            let row = table.insertRow(i);
            let cell = row.insertCell(0);
            cell.innerHTML = "<u>" + streamer.name + "</u> " + (additionalInfo != undefined ? additionalInfo : "");
            cell.onclick = function() {
                let container = document.getElementById("currentStreamer");
                container.innertHTML = streamer.login + "\n" + streamer.name + "\n" + streamer.department + "\n" + 
                    streamer.jobName + "\n" + streamer.phoneNumber + "\n" + streamer.email;
            };
        }
	</script>
</head>
<body>
    <div>Online:</div>
    <table id="onlineTable"></table>
    <div>Offline:</div>
    <table id="offlineTable"></table>
    <div id="currentStreamer"></div>
    <img id="streamPlayer" height="300px">
</body>
</html>
